<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Piano Practice Assistant</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div id="app">
      <div id="home-screen" class="screen active">
        <header>
          <h1>🎹 ピアノとっくん</h1>
          <p class="subtitle">きょうはどのきょくをれんしゅうする？</p>
        </header>
        <div class="song-list" id="song-list"></div>
        <button class="add-song-btn" onclick="app.showAddSongModal()">
          + あたらしいきょくをついか
        </button>
        <div class="bottom-buttons">
          <button class="collection-btn" onclick="app.showCollectionScreen()">
            📖 なかまずかん
          </button>
          <button class="settings-btn" onclick="app.showSettingsScreen()">
            ⚙️ せってい
          </button>
        </div>
      </div>

      <div id="practice-screen" class="screen">
        <header>
          <button class="back-btn" onclick="app.showHomeScreen()">←</button>
          <h2 id="song-title"></h2>
        </header>
        <div class="view-toggle">
          <button class="view-btn active" onclick="app.showListView()">
            📋 リスト
          </button>
          <button class="view-btn" onclick="app.showSkillTreeView()">
            🌳 スキルツリー
          </button>
          <button class="view-btn" onclick="app.showCharacterBookView()">
            📖 図鑑
          </button>
        </div>
        <div class="practice-list" id="practice-list"></div>
        <div
          class="skill-tree-container"
          id="skill-tree-container"
          style="display: none"
        >
          <canvas id="skill-tree-canvas"></canvas>
        </div>
        <div class="character-book-container" id="character-book-container" style="display: none">
          <div class="character-book-header">
            <h3>🎵 ピアノペット図鑑 🎵</h3>
            <div class="completion-rate" id="completion-rate"></div>
          </div>
          <div class="character-grid" id="character-grid"></div>
        </div>
        <div class="practice-actions">
          <button class="add-practice-btn" onclick="app.showAddPracticeModal()">
            + れんしゅうこうもくをついか
          </button>
          <button
            class="add-practice-btn"
            onclick="app.showAddCheckPointModal()"
          >
            + ちゅういてんをついか
          </button>
        </div>
      </div>

      <div id="evaluation-screen" class="screen">
        <header>
          <button class="back-btn" onclick="app.showPracticeScreen()">←</button>
          <h2 id="practice-title"></h2>
        </header>
        <div class="evaluation-content">
          <div class="checkpoints-section">
            <p>きをつけるポイント</p>
            <div class="checkpoint-list" id="checkpoint-list"></div>
          </div>
          <div class="level-display">
            <p>いまのレベル</p>
            <div class="level-number" id="current-level">0</div>
            <div class="level-breakdown" id="level-breakdown">
              <div class="breakdown-item">
                <span class="breakdown-label">れんしゅうじかん:</span>
                <span class="breakdown-value" id="time-points">0pt</span>
              </div>
              <div class="breakdown-item">
                <span class="breakdown-label">できばえ:</span>
                <span class="breakdown-value" id="performance-points">0pt</span>
              </div>
              <div class="breakdown-item">
                <span class="breakdown-label">とりくみかた:</span>
                <span class="breakdown-value" id="attitude-points">0pt</span>
              </div>
            </div>
          </div>
          <div class="level-input">
            <p>きょうのできばえは？</p>
            <div class="level-options" id="level-options">
              <button class="level-option" data-level="0">
                <span class="emoji">😴</span>
                <span class="label">やるまえ</span>
              </button>
              <button class="level-option" data-level="3">
                <span class="emoji">💪</span>
                <span class="label">がんばりちゅう</span>
              </button>
              <button class="level-option" data-level="6">
                <span class="emoji">😊</span>
                <span class="label">まちがえるけど<br />できてきた</span>
              </button>
              <button class="level-option" data-level="9">
                <span class="emoji">😄</span>
                <span class="label">まちがえないで<br />できた</span>
              </button>
              <button class="level-option" data-level="10">
                <span class="emoji">🌟</span>
                <span class="label">マスター</span>
              </button>
            </div>
          </div>
          <div class="attitude-input">
            <p>きょうのとりくみかた</p>
            <div class="attitude-options" id="attitude-options">
              <button class="attitude-option" data-attitude="1">
                <span class="emoji">😑</span>
                <span class="label">あまりしゅうちゅう<br />できなかった</span>
              </button>
              <button class="attitude-option" data-attitude="2">
                <span class="emoji">👍</span>
                <span class="label">おやにいわれて<br />がんばれた</span>
              </button>
              <button class="attitude-option" data-attitude="3">
                <span class="emoji">🌟</span>
                <span class="label"
                  >じぶんでかんがえて<br />かいぜんできた</span
                >
              </button>
            </div>
          </div>
          <div class="practice-time">
            <p>れんしゅうじかん</p>
            <div class="timer-display">
              <div class="timer-count" id="timer-display">00:00</div>
              <div class="timer-controls">
                <button
                  class="timer-btn start"
                  id="timer-start"
                  onclick="app.startTimer()"
                >
                  <span class="icon">▶️</span>
                  <span>スタート</span>
                </button>
                <button
                  class="timer-btn stop"
                  id="timer-stop"
                  onclick="app.stopTimer()"
                  style="display: none"
                >
                  <span class="icon">⏸️</span>
                  <span>ストップ</span>
                </button>
                <button class="timer-btn reset" onclick="app.resetTimer()">
                  <span class="icon">🔄</span>
                  <span>リセット</span>
                </button>
              </div>
            </div>
            <div class="total-time">
              <p>
                これまでのれんしゅうじかん:
                <span id="total-practice-time">0</span>ぷん
              </p>
            </div>
          </div>
          <div class="button-group">
            <button class="save-btn" onclick="app.saveEvaluation()">
              ほぞん
            </button>
            <button class="clear-btn" onclick="app.clearPracticeData()">
              このれんしゅうのデータをけす
            </button>
          </div>
        </div>
      </div>

      <div id="settings-screen" class="screen">
        <header>
          <button class="back-btn" onclick="app.showHomeScreen()">←</button>
          <h2>せってい</h2>
        </header>
        <div class="settings-content">
          <p style="text-align: center; color: #666; margin-bottom: 20px">
            🌟
            Vercelにデプロイされている場合、APIキーは環境変数で管理されています
          </p>
          <div class="setting-group">
            <label>Gemini API キー</label>
            <input
              type="password"
              id="gemini-api-key"
              placeholder="ローカル開発時のみ必要"
              disabled
            />
          </div>
          <div class="setting-group">
            <label>11Labs API キー</label>
            <input
              type="password"
              id="elevenlabs-api-key"
              placeholder="ローカル開発時のみ必要"
              disabled
            />
          </div>
          <div class="setting-group">
            <label>OpenAI API キー</label>
            <input
              type="password"
              id="openai-api-key"
              placeholder="ローカル開発時のみ必要"
              disabled
            />
          </div>
          <p
            style="
              text-align: center;
              color: #999;
              font-size: 0.9rem;
              margin-top: 20px;
            "
          >
            APIキーの設定はVercelの環境変数で行ってください
          </p>
        </div>
      </div>

      <div id="level-up-modal" class="modal">
        <div class="modal-content expanded">
          <div class="character-section">
            <div class="character-image" id="character-image">
              <div class="loading-spinner">🌟</div>
            </div>
            <div class="character-info">
              <h4 id="character-name">???</h4>
              <p class="character-species" id="character-species">???</p>
              <p class="character-catchphrase" id="character-catchphrase">
                「...」
              </p>
            </div>
          </div>
          <h3>レベルアップ！</h3>
          <p id="level-up-message"></p>
          <div class="ai-message" id="ai-message"></div>
          <button
            class="audio-btn"
            id="play-audio-btn"
            onclick="app.playAudioMessage()"
            style="display: none"
          >
            🔊 もういちど きく
          </button>
          <button onclick="app.closeLevelUpModal()">とじる</button>
        </div>
      </div>

      <div id="add-checkpoint-modal" class="modal">
        <div class="modal-content">
          <h3>ちゅういてんをついか</h3>
          <div class="modal-form">
            <label>れんしゅうこうもく</label>
            <select id="practice-select"></select>
            <label>きをつけること</label>
            <input
              type="text"
              id="checkpoint-text"
              placeholder="れい: ゆびばんごうをまもる"
            />
            <div class="modal-buttons">
              <button onclick="app.closeAddCheckPointModal()">
                キャンセル
              </button>
              <button class="primary" onclick="app.addCheckPoint()">
                ついか
              </button>
            </div>
          </div>
        </div>
      </div>

      <div id="add-song-modal" class="modal">
        <div class="modal-content">
          <h3>あたらしいきょくをついか</h3>
          <div class="modal-form">
            <label>きょくのなまえ</label>
            <input
              type="text"
              id="new-song-title"
              placeholder="れい: きらきらぼし"
            />
            <div class="modal-buttons">
              <button onclick="app.closeAddSongModal()">キャンセル</button>
              <button class="primary" onclick="app.addSong()">ついか</button>
            </div>
          </div>
        </div>
      </div>

      <div id="add-practice-modal" class="modal">
        <div class="modal-content">
          <h3>れんしゅうこうもくをついか</h3>
          <div class="modal-form">
            <label>れんしゅうのなまえ</label>
            <input
              type="text"
              id="new-practice-title"
              placeholder="れい: 1だんめ りょうてでゆっくり"
            />
            <label>せつめい</label>
            <input
              type="text"
              id="new-practice-description"
              placeholder="れい: テンポ60でただしく"
            />
            <div class="modal-buttons">
              <button onclick="app.closeAddPracticeModal()">キャンセル</button>
              <button class="primary" onclick="app.addPractice()">
                ついか
              </button>
            </div>
          </div>
        </div>
      </div>

      <div id="edit-practice-modal" class="modal">
        <div class="modal-content">
          <h3>れんしゅうこうもくをへんしゅう</h3>
          <div class="modal-form">
            <label>れんしゅうのなまえ</label>
            <input
              type="text"
              id="edit-practice-title"
              placeholder="れい: 1だんめ りょうてでゆっくり"
            />
            <label>せつめい</label>
            <input
              type="text"
              id="edit-practice-description"
              placeholder="れい: テンポ60でただしく"
            />
            <div class="modal-buttons">
              <button onclick="app.closeEditPracticeModal()">キャンセル</button>
              <button class="primary" onclick="app.updatePractice()">
                こうしん
              </button>
            </div>
          </div>
        </div>
      </div>

      <div id="collection-screen" class="screen">
        <header>
          <button class="back-btn" onclick="app.showHomeScreen()">←</button>
          <h2>🎵 おんがくのもり なかまずかん</h2>
        </header>
        <div class="collection-stats">
          <p>はっけんしたなかま: <span id="collection-count">0</span> / ???</p>
          <div class="rarity-legend">
            <span class="rarity-item">⭐ ふつう</span>
            <span class="rarity-item">⭐⭐ めずらしい</span>
            <span class="rarity-item">⭐⭐⭐ とてもめずらしい</span>
            <span class="rarity-item">⭐⭐⭐⭐ でんせつ</span>
          </div>
        </div>
        <div class="collection-grid" id="collection-grid"></div>
      </div>

      <div id="character-detail-modal" class="modal">
        <div class="modal-content character-detail">
          <button class="close-detail-btn" onclick="app.closeCharacterDetail()">
            ×
          </button>
          <div class="detail-image" id="detail-image"></div>
          <h3 id="detail-name"></h3>
          <p class="detail-species" id="detail-species"></p>
          <div class="detail-info">
            <p class="detail-date">
              はじめてあった日: <span id="detail-date"></span>
            </p>
            <p class="detail-rarity">
              レア度: <span id="detail-rarity"></span>
            </p>
            <p class="detail-ability">
              とくしゅのうりょく: <span id="detail-ability"></span>
            </p>
          </div>
          <blockquote
            class="detail-catchphrase"
            id="detail-catchphrase"
          ></blockquote>
          <div class="detail-message" id="detail-message"></div>
          <button class="audio-btn" onclick="app.playCharacterVoice()">
            🔊 こえをきく
          </button>
        </div>
      </div>
    </div>

    <script src="api-client-vercel.js"></script>
    <script type="module" src="characters.js"></script>
    <script src="app.js"></script>
  </body>
</html>
